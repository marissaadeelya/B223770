---
title: "How do salbutamol prescriptions in Scotland vary by season, and to what extent are these patterns influenced by age groups?"
output: html_document
date: "2025-11-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
```

## Background : Salbutamol

Salbutamol is commonly used to relieve respiratory symptoms in asthma and chronic obstructive pulmonary disease (COPD). It relaxes airway muscles, making it easier to breathe during breathing difficulties or flare-ups. As a widely prescribed drug, it is available as inhalers, nebulizers, and tablets, reflecting the high prevalence of respiratory conditions. Its use has been reported to vary seasonally, often peaking in colder months. Therefore, this report aims to investigate whether these seasonal trends are also observed specifically in Scotland, in order to better understand patterns in respiratory care.

```{r load_data_June23_to_May25, echo=FALSE}
library(tidyverse)
library(janitor) 
library(here)


files <- list.files(here("data", "consecutive_data"), pattern = ".csv")

consecutive_data <- files %>%
    map_dfr( ~ read_csv(here("data", "consecutive_data", .),
    col_types = cols(DMDCode = col_character()))) %>%
    clean_names() %>% 
    select (hbt , bnf_item_description,  paid_quantity, paid_date_month) 
   
```

## Introducing Salbutamol Data by Season for 2 Complete Cycles (June 2023 - May 2025)

This section filters data to focus only on salbutamol prescriptions, excluding the non-official NHS health board code (SB0806). The aim is to capture seasonal prescription trends across Scotland before introducing regional differences.

```{r salbutamol data}
salbutamol_data <- consecutive_data %>%
  filter(str_detect(bnf_item_description, "SALBUTAMOL"),
         hbt != "SB0806") %>%
  mutate(paid_date_month = parse_date_time(paid_date_month, "ym"),
         month_number = month(paid_date_month),
         year = case_when(
           month_number >= 6 ~ paste0(year(paid_date_month), "/", year(paid_date_month) + 1),
           TRUE ~ paste0(year(paid_date_month) - 1, "/", year(paid_date_month))
         ),
         season = case_when(
           month_number %in% c(12, 1, 2) ~ "Winter",
           month_number %in% c(3, 4, 5) ~ "Spring",
           month_number %in% c(6, 7, 8) ~ "Summer",
           month_number %in% c(9, 10, 11) ~ "Autumn"
         ),
         season = factor(season, levels = c("Summer", "Autumn", "Winter", "Spring"))
  ) %>%
  group_by(paid_date_month, hbt, bnf_item_description, season, year) %>%
  summarise(total_prescriptions = sum(paid_quantity, na.rm = TRUE), .groups = "drop")

```

## Aim 1 - Investigating if salbutamol prescriptions fluctuate by season across Scotland.

```{r,echo=FALSE}
# Aggregate data across all boards for national-level view
salbutamol_overall_season <- salbutamol_data %>%
  group_by(season, year) %>%
  summarise(total_prescriptions = sum(total_prescriptions, na.rm = TRUE), .groups = "drop")

# Line plot
plot_seasonal_trend <- salbutamol_overall_season  %>% 
  ggplot(aes(x = season, y = total_prescriptions, 
         group = year, color = factor(year))) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_brewer(palette = "Dark2") +
  labs(
    title = "Seasonal Distribution of Salbutamol Prescriptions in Scotland",
    subtitle = "Each line represents a June–May year period",
    x = "Season",
    y = "Total Prescriptions",
    color = "Year Group (June–May)"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 15),
    axis.text.x = element_text(angle = 30, hjust = 1),
    legend.position = "bottom"
  )

plot_seasonal_trend

```

Figure 1 illustrates the overall seasonal trend in salbutamol prescriptions across Scotland, showing that total prescriptions fluctuate seasonally, peaking in winter and declining in spring. This pattern is consistent with previous studies and reflects higher rates of respiratory infections and asthma exacerbations during colder months.

## Aim 2 - Comparing Salbutamol Prescriptions Trend by NHS Board

The next step is to examine whether this seasonal pattern is consistent across different NHS Boards. While total prescriptions reveal clear seasonal variation, these values are influenced by population size differences across NHS Boards.To allow meaningful comparison, prescription rates were calculated per head using NHS Board population estimates.

I did facet line chart and found similar trend across all boards with peak in winter, consistent for 2 years comparison.

## Aim 3 - Identify Which Age Group Influence Higher Prescription During Winter Across Scotland
I created a facet bar chart by NHS Board showing the two-year pattern, which revealed a similar trend, with higher salbutamol prescriptions in the 40–64 years age group. I plan to proceed with my fourth plot to produce a map; however, due to page limitations, I might replace this bar chart with multiple maps representing different age groups. I expect that the map for the 40–64 years age group will display stronger colour intensity compared to the other maps. I would greatly appreciate your thoughts on this. Thank you so much :)

